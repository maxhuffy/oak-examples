type SHAAlgorithm = 'SHA-1' | 'SHA-256';

async function shaHash(value: string | BufferSource, algorithm: SHAAlgorithm): Promise<string> {
  const message = typeof value === 'string' ? new TextEncoder().encode(value) : value;
  const hashBuffer = await crypto.subtle.digest(algorithm, message);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => `00${b.toString(16)}`.slice(-2)).join('');
}

export const objectKeysHash = (object: Record<string, any>): Promise<string> =>
  shaHash(
    Object.keys(object)
      .sort((a, b) => a.localeCompare(b))
      .join(''),
    'SHA-1',
  );

function getRandomValues(length: number): Uint8Array {
  const array = new Uint8Array(length);
  crypto.getRandomValues(array);
  return array;
}

export const cryptoUtils = {
  shaHash,
  objectKeysHash,
  getRandomValues,
};
