import * as QrCode from 'qrcode';

const encodeQrValue = (value: string) => {
  return encodeURI(value).replace(/[!#@$&'()*]/g, c => `%${c.charCodeAt(0).toString(16).toUpperCase()}`);
};

export async function createQrCode(data: Record<string, string | null | undefined>): Promise<string> {
  let qrData = '';
  for (const [key, value] of Object.entries(data)) {
    const encodedValue = value ? encodeQrValue(value) : '';
    qrData += `${key}:${encodedValue};;`;
  }
  return QrCode.toDataURL(qrData);
}
