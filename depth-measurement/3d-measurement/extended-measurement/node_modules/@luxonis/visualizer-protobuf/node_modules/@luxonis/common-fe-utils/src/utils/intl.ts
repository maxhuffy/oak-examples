import { createIntl, createIntlCache } from 'react-intl';
import type { CustomFormats } from 'react-intl';

import { log } from '../logger.js';

export const customFormats: CustomFormats = {
  number: {
    bytes: {
      style: 'decimal',
      maximumFractionDigits: 1,
    },
    temperature: {
      style: 'decimal',
      maximumFractionDigits: 0,
    },
  },
  date: {
    log: {
      dateStyle: undefined,
      timeStyle: 'medium',
      hourCycle: 'h24',
    },
    short: {
      dateStyle: 'short',
      timeStyle: 'short',
    },
    long: {
      dateStyle: 'long',
      timeStyle: 'long',
    },
  },
};

const onIntlError = (error: any): void => {
  if (typeof window !== 'undefined') {
    log.fatal(error);
  }
};

const cache = createIntlCache();

const intl = createIntl(
  {
    locale: 'en-US',
    defaultLocale: 'en-US',
    formats: customFormats,
    onError: onIntlError,
  },
  cache,
);

export default intl;
